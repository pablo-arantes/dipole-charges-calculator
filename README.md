## Dipole Charges Calculator 

Welcome to this repository. Here you will find all the code needed to run the least-squares fit solution for the adjustment of charges while keeping the total dipole moment of a molecule.

### CONTACT INFORMATION

Marcelo D. Polêto, Bruno Iochins Grisci, Marcio Dorn, Hugo Verli

Centro de Biotecnologia, Universidade Federal do Rio Grande do Sul

Institute of Informatics, Federal University of Rio Grande do Sul, Porto Alegre, RS, Brazil

E-mail: mdorn@inf.ufrgs.br, hverli@cbiot.ufrgs.br

http://sbcb.inf.ufrgs.br

### CITATION

If you use the dipole charges calculator in a publication, we would appreciate citations to the following papers:

Pablo R. Arantes, Marcelo D. Polêto, Elisa B. O. John, Conrado Pedebos, Bruno I. Grisci, Marcio Dorn, and Hugo Verli. 
"Development of GROMOS-Compatible Parameter Set for Simulations of Chalcones and Flavonoids" 
J. Phys. Chem. B, 2019, 123 (5), pp 994–1008
DOI: https://doi.org/10.1021/acs.jpcb.8b10139

Bibtex entry:
```
@article{arantes2019development,
  title={Development of GROMOS-Compatible Parameter Set for Simulations of Chalcones and Flavonoids},
  author={Arantes, Pablo Ricardo and Pol{\^e}to, Marcelo Dep{\'o}lo and John, Elisa Beatriz de Oliveira and Pedebos, Conrado and Grisci, Bruno I and Dorn, Marcio and Verli, Hugo},
  journal={The Journal of Physical Chemistry B},
  year={2019},
  volume={123},
  pages={994--1008},
  publisher={ACS Publications}
}
```

Marcelo D. Polêto, Victor H. Rusu, Bruno I. Grisci, Marcio Dorn, Roberto D. Lins and Hugo Verli.
"Aromatic Rings Commonly Used in Medicinal Chemistry: Force Fields Comparison and Interactions With Water Toward the Design of New Chemical Entities"
Frontiers in pharmacology, v. 9, 2018.
DOI: https://doi.org/10.3389/fphar.2018.00395

Bibtex entry:
```
@article{poleto2018aromatic,
  title={Aromatic Rings Commonly Used in Medicinal Chemistry: Force Fields Comparison and Interactions With Water Toward the Design of New Chemical Entities},
  author={Pol{\^e}to, Marcelo D and Rusu, Victor H and Grisci, Bruno I and Dorn, Marcio and Lins, Roberto D and Verli, Hugo},
  journal={Frontiers in pharmacology},
  volume={9},
  year={2018},
  publisher={Frontiers Media SA}
}
```

### HOW TO USE

This file explains how the dipole-charges derivation is done.

CREATING QM CHARGES

1- Run your QM calculation (MP2/6-31G - ESP) in your software of choice.

CREATING SUITABLE INPUT

2- Translate the obtained charges to a .mol2 file. It is important that the "@<TRIPOS>ATOM" line starts at line #8 of the .mol2 file. NOTE: your .mol2 file should be named "example-esp.mol2" (the "example" part can be modified).

Note that atomic charges placed in a cartesian space will generate a dipole moment vector. Since the atomic charges and coordinates were generated from a QM calculation, this "example-esp.mol2" will carry a QM dipole moment vector. Its direction will be a reference for this protocol.

DEFINING CHARGE UPPER AND LOWER BOUNDARIES

3- Run 
```
python write_csv.py example-esp.mol2
```
to obtain a "example.csv" file that will carry the charge boundaries.

This protocol is based on lower and upper boundaries for atomic charges, in a way that the solution generated by our protocol preserves the dipole moment direction.

This means that at each line, the two last columns in the .csv files are the lower and upper boundaries.

    ID            Atom                            X coord       Y coord        Z coord       QM charge       Lower          Upper     
     1,             C,             0,             -4.7584,       0.4116,        -0.2313,       0.0477,        -1.00,          1.00            
     2,             H,             0,             -6.1029,       2.1354,        -0.1405,       0.0287,        -1.00,          1.00            
     3,             O,             0,             -3.4992,       0.0043,         0.2795,      -0.3798,        -1.00,          1.00            

So the user should alter the lower and upper boundaries that the algorithm should use to generate a solution.

In general, non-polar carbons vary from -0.20 to +0.20. Oxygens and Nitrogens upper limit is -0.20. Hydrogens are always positive (lower limit of +0.00). Of course this is only my experience and can be altered if the user is certain of what he is doing. 

This is the place you should enter previously calibrated group charges. For example: benzenic C-H groups have -0.13 and +0.13 charge, respectivelly. Thus, the upper and lower limits will be equal, so the algorithm won't have any room to change it. If that is the case for the example above, it should be become:

    ID            Atom                            X coord       Y coord        Z coord       QM charge       Lower          Upper     
     1,             C,             0,             -4.7584,       0.4116,        -0.2313,       0.0477,        -0.13,         -0.13            
     2,             H,             0,             -6.1029,       2.1354,        -0.1405,       0.0287,         0.13,          0.13            
     3,             O,             0,             -3.4992,       0.0043,         0.2795,      -0.3798,        -0.80,         -0.20   

OBTAINING NEW SET OF CHARGES BASED ON DIPOLE MOMENT

4- Run
```
python getvector.py example.csv example-esp.mol2 Q C
```
with Q = the magnitude of the dipole moment generated (as a fraction of 1, e.g. 1.0 is 100%) and C = the total net charge of the molecule (0 for neutral molecules)

Example: 
```
python getvector.py example.csv example-esp.mol2 0.7 0.0
```
to obtain a new distribution of charges that sums 0 and, when applied to the coordinates from the .mol2 file, will generate a new dipole moment with the same direction of the QM, with 70% of its magnitude.

This step will generate a "example-lsql.mol2" file. It contains the same coordinates as the "example-esp.mol2", but with a new set of atomic charges.

Please check if the boundaries were respected!!!! If the boundaries defined on your .csv is too restrict, it is more likely that they will be violated. If that is the case, try other boundaries.

A good output will respect the defined boundaries and the change in magnitude required.

TIP: open both .mol2 files in VMD and visualize them using the Dipole Moment Watcher! 
